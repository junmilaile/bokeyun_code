import{D as e,q as a,a6 as t,z as l,Q as s,R as o,o as u,c as m,w as n,l as i,g as r,j as c,k as d,F as v,f as _,u as p,r as f}from"./index-6f7f74a6.js";import{a as y,_ as g,b as h}from"./comment-frame.def3478e.js";import{o as j,d as w,a as k,r as b}from"./uni-app.es.6c04d0ca.js";import{_ as x}from"./u-skeleton.2f23aa48.js";import{_ as I}from"./uni-load-more.fbd5f83d.js";import{a as z}from"./tools.321430c8.js";import{s as B}from"./store.a70c5c24.js";import{_ as S}from"./_plugin-vue_export-helper.1b428a4d.js";import"./uni-dateformat.3d3c3185.js";import"./uni-easyinput.46fdb077.js";import"./uni-icons.bcdec7e2.js";const T=S({__name:"rebly",setup(S){const T=e.database(),$=a(!1),q=a("more"),E=a(!1),M=a(!1),O=a({article_id:"",comment_type:1,reply_user_id:"",reply_comment_id:""}),R=a(!0),A=a("");j((e=>{let a=t("replyItem");a||(l({title:"参数错误",icon:"none"}),setTimeout((()=>{s()}),1e3)),A.value=a||{},O.value.comment=e.comment,O.value.article_id=A.value.article_id,O.value.reply_user_id=A.value.user_id[0]._id,O.value.reply_comment_id=A.value._id,D()}));const C=a([]),D=async()=>{const e=T.collection("quanzi_comment").where(`article_id == '${A.value.article_id}' && comment_type == 1 && reply_comment_id == "${A.value._id}"`).orderBy("comment_date desc").getTemp(),a=T.collection("uni-id-users").field("_id,avatar_file,username,nickname").getTemp(),t=await T.collection(e,a).where("comment_status != 0").skip(C.value.length).limit(5).get();console.log(t),0===t.result.data.length&&(E.value=!0),5===t.result.data.length&&($.value=!0);const l=[...C.value,...t.result.data];C.value=l,R.value=!1,C.value.length||(M.value=!0)};w((()=>{o("replyItem")}));const F=e=>{C.value=C.value.filter((a=>a._id!=e._id))};k((async()=>{q.value="loading",E.value?q.value="noMore":(await D(),E.value&&(q.value="noMore"))}));const G=e=>{l({title:"回复成功"}),C.value.unshift({...O.value,...e,user_id:[B.userInfo]}),R.value=!1};return(e,a)=>{const t=b(f("comment-item"),y),l=i,s=b(f("u-skeleton"),x),o=b(f("uni-load-more"),I),j=b(f("u-empty"),g),w=b(f("comment-frame"),h);return u(),m(l,{class:"reply"},{default:n((()=>[r(l,{class:"top"},{default:n((()=>[r(t,{childState:!0,closeBtn:!0,item:A.value},null,8,["item"])])),_:1}),r(l,{class:"list"},{default:n((()=>[R.value?(u(),m(l,{key:0},{default:n((()=>[r(s,{rows:"2",title:"",loading:"",avatar:""})])),_:1})):(u(!0),c(v,{key:1},d(C.value,(e=>(u(),m(l,{class:"row"},{default:n((()=>[r(t,{onRemoveEnv:F,childState:!0,item:e},null,8,["item"])])),_:2},1024)))),256))])),_:1}),r(l,null,{default:n((()=>[$.value?(u(),m(o,{key:0,status:q.value},null,8,["status"])):_("",!0)])),_:1}),!C.value.length&&M.value?(u(),m(l,{key:0},{default:n((()=>[r(j,{mode:"comment",icon:"https://cdn.uviewui.com/uview/empty/comment.png"})])),_:1})):_("",!0),r(l,null,{default:n((()=>[r(w,{onCommentEnv:G,commentObjadd:O.value,placeholder:`回复：${p(z)(A.value)}`},null,8,["commentObjadd","placeholder"])])),_:1})])),_:1})}}},[["__scopeId","data-v-3b6d19a2"]]);export{T as default};
