import{D as e,v as s,z as a,o as t,c as i,w as o,l as n,g as r,b as u,f as l,t as p,E as c,i as d,r as m,J as f}from"./index-6f7f74a6.js";import{_ as h}from"./uni-easyinput.46fdb077.js";import{r as g}from"./uni-app.es.6c04d0ca.js";import{_}from"./uni-forms-item.3fa67a8a.js";import{_ as w}from"./uni-forms.6270aa8b.js";import{_ as j}from"./uni-captcha.07cd8bce.js";import{_ as C}from"./uni-id-pages-agreements.4a4c1d0c.js";import{_ as b}from"./uni-id-pages-fab-login.0a39f6ee.js";import{m as k}from"./login-page.mixin.6ecb4a99.js";import{_ as y}from"./_plugin-vue_export-helper.1b428a4d.js";import"./uni-icons.bcdec7e2.js";import"./uni-popup-dialog.f9be20a5.js";import"./uni-popup.c460a42c.js";import"./store.a70c5c24.js";const v=e.importObject("uni-id-co",{errorOptions:{type:"toast"}});const x=y({mixins:[k],data:()=>({password:"",username:"",captcha:"",needCaptcha:!1,focusUsername:!1,focusPassword:!1,logo:"/static/logo.png"}),onShow(){document.onkeydown=e=>{var s=e||window.event;s&&13==s.keyCode&&this.pwdLogin()}},methods:{toRetrievePwd(){let e="/uni_modules/uni-id-pages/pages/retrieve/retrieve";/^1\d{10}$/.test(this.username)&&(e+=`?phoneNumber=${this.username}`),s({url:e})},pwdLogin(){if(!this.password.length)return this.focusPassword=!0,a({title:"请输入密码",icon:"none",duration:3e3});if(!this.username.length)return this.focusUsername=!0,a({title:"请输入手机号/用户名/邮箱",icon:"none",duration:3e3});if(this.needCaptcha&&4!=this.captcha.length)return this.$refs.captcha.getImageCaptcha(),a({title:"请输入验证码",icon:"none",duration:3e3});if(this.needAgreements&&!this.agree)return this.$refs.agreements.popup(this.pwdLogin);let e={password:this.password,captcha:this.captcha};/^1\d{10}$/.test(this.username)?e.mobile=this.username:/@/.test(this.username)?e.email=this.username:e.username=this.username,v.login(e).then((e=>{this.loginSuccess(e)})).catch((e=>{"uni-id-captcha-required"==e.errCode?this.needCaptcha=!0:this.needCaptcha&&this.$refs.captcha.getImageCaptcha()}))},toRegister(){s({url:this.config.isAdmin?"/uni_modules/uni-id-pages/pages/register/register-admin":"/uni_modules/uni-id-pages/pages/register/register",fail(e){console.error(e)}})}}},[["render",function(e,s,a,k,y,v){const x=c,V=n,U=d,L=g(m("uni-easyinput"),h),P=g(m("uni-forms-item"),_),$=g(m("uni-forms"),w),B=g(m("uni-captcha"),j),A=g(m("uni-id-pages-agreements"),C),R=f,I=g(m("uni-id-pages-fab-login"),b);return t(),i(V,{class:"uni-content"},{default:o((()=>[r(V,{class:"login-logo"},{default:o((()=>[r(x,{src:y.logo},null,8,["src"])])),_:1}),r(U,{class:"title title-box"},{default:o((()=>[u("账号密码登录")])),_:1}),r($,null,{default:o((()=>[r(P,{name:"username"},{default:o((()=>[r(L,{focus:y.focusUsername,onBlur:s[0]||(s[0]=e=>y.focusUsername=!1),class:"input-box",inputBorder:!1,modelValue:y.username,"onUpdate:modelValue":s[1]||(s[1]=e=>y.username=e),placeholder:"请输入手机号/用户名/邮箱"},null,8,["focus","modelValue"])])),_:1}),r(P,{name:"password"},{default:o((()=>[r(L,{focus:y.focusPassword,onBlur:s[2]||(s[2]=e=>y.focusPassword=!1),class:"input-box",clearable:"",type:"password",inputBorder:!1,modelValue:y.password,"onUpdate:modelValue":s[3]||(s[3]=e=>y.password=e),placeholder:"请输入密码"},null,8,["focus","modelValue"])])),_:1})])),_:1}),y.needCaptcha?(t(),i(B,{key:0,focus:"",ref:"captcha",scene:"login-by-pwd",modelValue:y.captcha,"onUpdate:modelValue":s[4]||(s[4]=e=>y.captcha=e)},null,8,["modelValue"])):l("",!0),r(A,{scope:"login",ref:"agreements"},null,512),r(R,{class:"uni-btn",type:"primary",onClick:v.pwdLogin},{default:o((()=>[u("登录")])),_:1},8,["onClick"]),r(V,{class:"link-box"},{default:o((()=>[e.config.isAdmin?l("",!0):(t(),i(V,{key:0},{default:o((()=>[r(U,{class:"forget"},{default:o((()=>[u("忘记了？")])),_:1}),r(U,{class:"link",onClick:v.toRetrievePwd},{default:o((()=>[u("找回密码")])),_:1},8,["onClick"])])),_:1})),r(U,{class:"link",onClick:v.toRegister},{default:o((()=>[u(p(e.config.isAdmin?"注册管理员账号":"注册账号"),1)])),_:1},8,["onClick"])])),_:1}),r(I,{ref:"uniFabLogin"},null,512)])),_:1})}],["__scopeId","data-v-42476a32"]]);export{x as default};
