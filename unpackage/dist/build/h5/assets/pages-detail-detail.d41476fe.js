import{ad as t,ae as e,s,v as i,af as a,a0 as n,o as l,c as o,w as r,j as c,F as h,k as d,e as u,f as p,n as m,p as g,b as f,t as y,g as v,E as b,i as _,l as k,ag as x,ah as w,U as T,a3 as $,K as N,ai as L,h as O,D as j,q as S,$ as I,z as C,M as R,a6 as z,u as A,B as q,C as B,r as E}from"./index-6f7f74a6.js";import{_ as F}from"./u-skeleton.2f23aa48.js";import{o as V,a as D,r as M}from"./uni-app.es.6c04d0ca.js";import{_ as P}from"./uni-dateformat.3d3c3185.js";import{_ as U}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as G,a as Z,b as K}from"./comment-frame.def3478e.js";import{_ as W}from"./uni-load-more.fbd5f83d.js";import{l as H,g as J,a as Q}from"./tools.321430c8.js";import{s as X}from"./store.a70c5c24.js";import"./uni-easyinput.46fdb077.js";import"./uni-icons.bcdec7e2.js";var Y={abbr:!0,b:!0,big:!0,code:!0,del:!0,em:!0,i:!0,ins:!0,label:!0,q:!0,small:!0,span:!0,strong:!0,sub:!0,sup:!0};const tt={isInline:function(t,e){return Y[t]||-1!==(e||"").indexOf("display:inline")}},et=t=>{t.$wxs||(t.$wxs=[]),t.$wxs.push("handler"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.handler=tt}})},st={name:"node",options:{},data:()=>({ctrl:{}}),props:{name:String,attrs:{type:Object,default:()=>({})},childs:Array,opts:Array},components:{},mounted(){if(this.$nextTick((()=>{for(this.root=this.$parent;"u-parse"!==this.root.$options.name;this.root=this.root.$parent);})),this.opts[0]){let e;for(e=this.childs.length;e--&&"img"!==this.childs[e].name;);-1!==e&&(this.observer=t(this).relativeToViewport({top:500,bottom:500}),this.observer.observe("._img",(t=>{t.intersectionRatio&&(this.$set(this.ctrl,"load",1),this.observer.disconnect())})))}},beforeDestroy(){this.observer&&this.observer.disconnect()},methods:{play(t){if(this.root.$emit("play"),this.root.pauseVideo){let s=!1;const i=t.target.id;for(let t=this.root._videos.length;t--;)this.root._videos[t].id===i?s=!0:this.root._videos[t].pause();if(!s){const t=e(i,this);t.id=i,this.root.playbackRate&&t.playbackRate(this.root.playbackRate),this.root._videos.push(t)}}},imgTap(t){const e=this.childs[t.currentTarget.dataset.i];e.a?this.linkTap(e.a):e.attrs.ignore||(e.attrs.src=e.attrs.src||e.attrs["data-src"],this.root.$emit("imgtap",e.attrs),this.root.previewImg&&s({current:parseInt(e.attrs.i),urls:this.root.imgList}))},imgLongTap(t){},imgLoad(t){const e=t.currentTarget.dataset.i;(this.opts[1]&&!this.ctrl[e]||-1===this.ctrl[e])&&this.$set(this.ctrl,e,1),this.checkReady()},checkReady(){this.root.lazyLoad||(this.root._unloadimgs-=1,this.root._unloadimgs||setTimeout((()=>{this.root.getRect().then((t=>{this.root.$emit("ready",t)})).catch((()=>{this.root.$emit("ready",{})}))}),350))},linkTap(t){const e=t.currentTarget?this.childs[t.currentTarget.dataset.i]:{},s=e.attrs||t,n=s.href;this.root.$emit("linktap",Object.assign({innerText:this.root.getText(e.children||[])},s)),n&&("#"===n[0]?this.root.navigateTo(n.substring(1)).catch((()=>{})):n.split("?")[0].includes("://")?this.root.copyLink&&window.open(n):i({url:n,fail(){a({url:n,fail(){}})}}))},mediaError(t){const e=t.currentTarget.dataset.i,s=this.childs[e];if("video"===s.name||"audio"===s.name){let t=(this.ctrl[e]||0)+1;if(t>s.src.length&&(t=0),t<s.src.length)return void this.$set(this.ctrl,e,t)}else if("img"===s.name){if(this.opts[0]&&!this.ctrl.load)return;this.opts[2]&&this.$set(this.ctrl,e,-1),this.checkReady()}this.root&&this.root.$emit("error",{source:s.name,attrs:s.attrs})}}};et(st);const it=U(st,[["render",function(t,e,s,i,a,T){const $=b,N=_,L=n("node",!0),O=k,j=x,S=w;return l(),o(O,{id:s.attrs.id,class:m("_block _"+s.name+" "+s.attrs.class),style:u(s.attrs.style)},{default:r((()=>[(l(!0),c(h,null,d(s.childs,((i,n)=>(l(),c(h,{key:n},["img"===i.name&&!i.t&&(s.opts[1]&&!a.ctrl[n]||a.ctrl[n]<0)?(l(),o($,{key:0,class:"_img",style:u(i.attrs.style),src:a.ctrl[n]<0?s.opts[2]:s.opts[1],mode:"widthFix"},null,8,["style","src"])):p("",!0),"img"===i.name?(l(),c("img",{key:1,id:i.attrs.id,class:m("_img "+i.attrs.class),style:u((-1===a.ctrl[n]?"display:none;":"")+i.attrs.style),src:i.attrs.src||(a.ctrl.load?i.attrs["data-src"]:""),"data-i":n,onLoad:e[0]||(e[0]=(...t)=>T.imgLoad&&T.imgLoad(...t)),onError:e[1]||(e[1]=(...t)=>T.mediaError&&T.mediaError(...t)),onClick:e[2]||(e[2]=g(((...t)=>T.imgTap&&T.imgTap(...t)),["stop"])),onLongpress:e[3]||(e[3]=(...t)=>T.imgLongTap&&T.imgLongTap(...t))},null,46,["id","src","data-i"])):i.text?(l(),o(N,{key:2,decode:""},{default:r((()=>[f(y(i.text),1)])),_:2},1024)):"br"===i.name?(l(),o(N,{key:3},{default:r((()=>[f("\\n")])),_:1})):"a"===i.name?(l(),o(O,{key:4,id:i.attrs.id,class:m((i.attrs.href?"_a ":"")+i.attrs.class),"hover-class":"_hover",style:u("display:inline;"+i.attrs.style),"data-i":n,onClick:g(T.linkTap,["stop"])},{default:r((()=>[v(L,{name:"span",childs:i.children,opts:s.opts,style:{display:"inherit"}},null,8,["childs","opts"])])),_:2},1032,["id","class","style","data-i","onClick"])):"video"===i.name?(l(),o(j,{key:5,id:i.attrs.id,class:m(i.attrs.class),style:u(i.attrs.style),autoplay:i.attrs.autoplay,controls:i.attrs.controls,loop:i.attrs.loop,muted:i.attrs.muted,"object-fit":i.attrs["object-fit"],poster:i.attrs.poster,src:i.src[a.ctrl[n]||0],"data-i":n,onPlay:T.play,onError:T.mediaError},null,8,["id","class","style","autoplay","controls","loop","muted","object-fit","poster","src","data-i","onPlay","onError"])):"iframe"===i.name?(l(),c("iframe",{key:6,style:u(i.attrs.style),allowfullscreen:i.attrs.allowfullscreen,frameborder:i.attrs.frameborder,src:i.attrs.src},null,12,["allowfullscreen","frameborder","src"])):"embed"===i.name?(l(),c("embed",{key:7,style:u(i.attrs.style),src:i.attrs.src},null,12,["src"])):"table"===i.name&&i.c||"li"===i.name?(l(),o(O,{key:8,id:i.attrs.id,class:m("_"+i.name+" "+i.attrs.class),style:u(i.attrs.style)},{default:r((()=>["li"===i.name?(l(),o(L,{key:0,childs:i.children,opts:s.opts},null,8,["childs","opts"])):(l(!0),c(h,{key:1},d(i.children,((t,e)=>(l(),o(O,{key:e,class:m("_"+t.name+" "+t.attrs.class),style:u(t.attrs.style)},{default:r((()=>["td"===t.name||"th"===t.name?(l(),o(L,{key:0,childs:t.children,opts:s.opts},null,8,["childs","opts"])):(l(!0),c(h,{key:1},d(t.children,((t,e)=>(l(),c(h,{key:e},["td"===t.name||"th"===t.name?(l(),o(O,{key:0,class:m("_"+t.name+" "+t.attrs.class),style:u(t.attrs.style)},{default:r((()=>[v(L,{childs:t.children,opts:s.opts},null,8,["childs","opts"])])),_:2},1032,["class","style"])):(l(),o(O,{key:1,class:m("_"+t.name+" "+t.attrs.class),style:u(t.attrs.style)},{default:r((()=>[(l(!0),c(h,null,d(t.children,((t,e)=>(l(),o(O,{key:e,class:m("_"+t.name+" "+t.attrs.class),style:u(t.attrs.style)},{default:r((()=>[v(L,{childs:t.children,opts:s.opts},null,8,["childs","opts"])])),_:2},1032,["class","style"])))),128))])),_:2},1032,["class","style"]))],64)))),128))])),_:2},1032,["class","style"])))),128))])),_:2},1032,["id","class","style"])):i.c||t.handler.isInline(i.name,i.attrs.style)?2===i.c?(l(),o(O,{key:10,id:i.attrs.id,class:m("_block _"+i.name+" "+i.attrs.class),style:u(i.f+";"+i.attrs.style)},{default:r((()=>[(l(!0),c(h,null,d(i.children,((t,e)=>(l(),o(L,{key:e,style:u(t.f),name:t.name,attrs:t.attrs,childs:t.children,opts:s.opts},null,8,["style","name","attrs","childs","opts"])))),128))])),_:2},1032,["id","class","style"])):(l(),o(L,{key:11,style:u(i.f),name:i.name,attrs:i.attrs,childs:i.children,opts:s.opts},null,8,["style","name","attrs","childs","opts"])):(l(),o(S,{key:9,id:i.attrs.id,style:u(i.f),"user-select":s.opts[4],nodes:[i]},null,8,["id","style","user-select","nodes"]))],64)))),128))])),_:1},8,["id","class","style"])}],["__scopeId","data-v-1e248563"]]),at={trustTags:ct("a,abbr,ad,audio,b,blockquote,br,code,col,colgroup,dd,del,dl,dt,div,em,fieldset,h1,h2,h3,h4,h5,h6,hr,i,img,ins,label,legend,li,ol,p,q,ruby,rt,source,span,strong,sub,sup,table,tbody,td,tfoot,th,thead,tr,title,ul,video"),blockTags:ct("address,article,aside,body,caption,center,cite,footer,header,html,nav,pre,section"),ignoreTags:ct("area,base,canvas,embed,frame,head,iframe,input,link,map,meta,param,rp,script,source,style,textarea,title,track,wbr"),voidTags:ct("area,base,br,col,circle,ellipse,embed,frame,hr,img,input,line,link,meta,param,path,polygon,rect,source,track,use,wbr"),entities:{lt:"<",gt:">",quot:'"',apos:"'",ensp:" ",emsp:" ",nbsp:" ",semi:";",ndash:"–",mdash:"—",middot:"·",lsquo:"‘",rsquo:"’",ldquo:"“",rdquo:"”",bull:"•",hellip:"…",larr:"←",uarr:"↑",rarr:"→",darr:"↓"},tagStyle:{address:"font-style:italic",big:"display:inline;font-size:1.2em",caption:"display:table-caption;text-align:center",center:"text-align:center",cite:"font-style:italic",dd:"margin-left:40px",mark:"background-color:yellow",pre:"font-family:monospace;white-space:pre",s:"text-decoration:line-through",small:"display:inline;font-size:0.8em",strike:"text-decoration:line-through",u:"text-decoration:underline"},svgDict:{animatetransform:"animateTransform",lineargradient:"linearGradient",viewbox:"viewBox",attributename:"attributeName",repeatcount:"repeatCount",repeatdur:"repeatDur"}},nt={},{windowWidth:lt}=T(),ot=ct(" ,\r,\n,\t,\f");let rt=0;function ct(t){const e=Object.create(null),s=t.split(",");for(let i=s.length;i--;)e[s[i]]=!0;return e}function ht(t,e){let s=t.indexOf("&");for(;-1!==s;){const i=t.indexOf(";",s+3);let a;if(-1===i)break;"#"===t[s+1]?(a=parseInt(("x"===t[s+2]?"0":"")+t.substring(s+2,i)),isNaN(a)||(t=t.substr(0,s)+String.fromCharCode(a)+t.substr(i+1))):(a=t.substring(s+1,i),(at.entities[a]||"amp"===a&&e)&&(t=t.substr(0,s)+(at.entities[a]||"&")+t.substr(i+1))),s=t.indexOf("&",s+1)}return t}function dt(t){let e=t.length-1;for(let s=e;s>=-1;s--)(-1===s||t[s].c||!t[s].name||"div"!==t[s].name&&"p"!==t[s].name&&"h"!==t[s].name[0]||(t[s].attrs.style||"").includes("inline"))&&(e-s>=5&&t.splice(s+1,e-s,{name:"div",attrs:{},children:t.slice(s+1,e+1)}),e=s-1)}function ut(t){this.options=t||{},this.tagStyle=Object.assign({},at.tagStyle,this.options.tagStyle),this.imgList=t.imgList||[],this.imgList._unloadimgs=0,this.plugins=t.plugins||[],this.attrs=Object.create(null),this.stack=[],this.nodes=[],this.pre=(this.options.containerStyle||"").includes("white-space")&&this.options.containerStyle.includes("pre")?2:0}function pt(t){this.handler=t}at.ignoreTags.iframe=void 0,at.trustTags.iframe=!0,at.ignoreTags.embed=void 0,at.trustTags.embed=!0,ut.prototype.parse=function(t){for(let e=this.plugins.length;e--;)this.plugins[e].onUpdate&&(t=this.plugins[e].onUpdate(t,at)||t);for(new pt(this).parse(t);this.stack.length;)this.popNode();return this.nodes.length>50&&dt(this.nodes),this.nodes},ut.prototype.expose=function(){for(let t=this.stack.length;t--;){const e=this.stack[t];if(e.c||"a"===e.name||"video"===e.name||"audio"===e.name)return;e.c=1}},ut.prototype.hook=function(t){for(let e=this.plugins.length;e--;)if(this.plugins[e].onParse&&!1===this.plugins[e].onParse(t,this))return!1;return!0},ut.prototype.getUrl=function(t){const e=this.options.domain;return"/"===t[0]?"/"===t[1]?t=(e?e.split("://")[0]:"http")+":"+t:e&&(t=e+t):t.includes("data:")||t.includes("://")||e&&(t=e+"/"+t),t},ut.prototype.parseStyle=function(t){const e=t.attrs,s=(this.tagStyle[t.name]||"").split(";").concat((e.style||"").split(";")),i={};let a="";e.id&&!this.xml&&(this.options.useAnchor?this.expose():"img"!==t.name&&"a"!==t.name&&"video"!==t.name&&"audio"!==t.name&&(e.id=void 0)),e.width&&(i.width=parseFloat(e.width)+(e.width.includes("%")?"%":"px"),e.width=void 0),e.height&&(i.height=parseFloat(e.height)+(e.height.includes("%")?"%":"px"),e.height=void 0);for(let n=0,l=s.length;n<l;n++){const t=s[n].split(":");if(t.length<2)continue;const e=t.shift().trim().toLowerCase();let l=t.join(":").trim();if("-"===l[0]&&l.lastIndexOf("-")>0||l.includes("safe"))a+=`;${e}:${l}`;else if(!i[e]||l.includes("import")||!i[e].includes("import")){if(l.includes("url")){let t=l.indexOf("(")+1;if(t){for(;'"'===l[t]||"'"===l[t]||ot[l[t]];)t++;l=l.substr(0,t)+this.getUrl(l.substr(t))}}else l.includes("rpx")&&(l=l.replace(/[0-9.]+\s*rpx/g,(t=>parseFloat(t)*lt/750+"px")));i[e]=l}}return t.attrs.style=a,i},ut.prototype.onTagName=function(t){this.tagName=this.xml?t:t.toLowerCase(),"svg"===this.tagName&&(this.xml=(this.xml||0)+1)},ut.prototype.onAttrName=function(t){"data-"===(t=this.xml?t:t.toLowerCase()).substr(0,5)?"data-src"!==t||this.attrs.src?"img"===this.tagName||"a"===this.tagName?this.attrName=t:this.attrName=void 0:this.attrName="src":(this.attrName=t,this.attrs[t]="T")},ut.prototype.onAttrVal=function(t){const e=this.attrName||"";"style"===e||"href"===e?this.attrs[e]=ht(t,!0):e.includes("src")?this.attrs[e]=this.getUrl(ht(t,!0)):e&&(this.attrs[e]=t)},ut.prototype.onOpenTag=function(t){const e=Object.create(null);e.name=this.tagName,e.attrs=this.attrs,this.options.nodes.length&&(e.type="node"),this.attrs=Object.create(null);const s=e.attrs,i=this.stack[this.stack.length-1],a=i?i.children:this.nodes,n=this.xml?t:at.voidTags[e.name];if(nt[e.name]&&(s.class=nt[e.name]+(s.class?" "+s.class:"")),"embed"===e.name&&this.expose(),"video"!==e.name&&"audio"!==e.name||("video"!==e.name||s.id||(s.id="v"+rt++),s.controls||s.autoplay||(s.controls="T"),e.src=[],s.src&&(e.src.push(s.src),s.src=void 0),this.expose()),n){if(!this.hook(e)||at.ignoreTags[e.name])return void("base"!==e.name||this.options.domain?"source"===e.name&&i&&("video"===i.name||"audio"===i.name)&&s.src&&i.src.push(s.src):this.options.domain=s.href);const t=this.parseStyle(e);if("img"===e.name){if(s.src&&(s.src.includes("webp")&&(e.webp="T"),s.src.includes("data:")&&!s["original-src"]&&(s.ignore="T"),!s.ignore||e.webp||s.src.includes("cloud://"))){for(let a=this.stack.length;a--;){const i=this.stack[a];"a"===i.name&&(e.a=i.attrs),"table"!==i.name||e.webp||s.src.includes("cloud://")||(!t.display||t.display.includes("inline")?e.t="inline-block":e.t=t.display,t.display=void 0),i.c=1}s.i=this.imgList.length.toString();let i=s["original-src"]||s.src;this.imgList.push(i),e.t||(this.imgList._unloadimgs+=1),this.options.lazyLoad&&(s["data-src"]=s.src,s.src=void 0)}"inline"===t.display&&(t.display=""),s.ignore&&(t["max-width"]=t["max-width"]||"100%",s.style+=";-webkit-touch-callout:none"),parseInt(t.width)>lt&&(t.height=void 0),isNaN(parseInt(t.width))||(e.w="T"),!isNaN(parseInt(t.height))&&(!t.height.includes("%")||i&&(i.attrs.style||"").includes("height"))&&(e.h="T")}else if("svg"===e.name)return a.push(e),this.stack.push(e),void this.popNode();for(const e in t)t[e]&&(s.style+=`;${e}:${t[e].replace(" !important","")}`);s.style=s.style.substr(1)||void 0}else("pre"===e.name||(s.style||"").includes("white-space")&&s.style.includes("pre"))&&2!==this.pre&&(this.pre=e.pre=1),e.children=[],this.stack.push(e);a.push(e)},ut.prototype.onCloseTag=function(t){let e;for(t=this.xml?t:t.toLowerCase(),e=this.stack.length;e--&&this.stack[e].name!==t;);if(-1!==e)for(;this.stack.length>e;)this.popNode();else if("p"===t||"br"===t){(this.stack.length?this.stack[this.stack.length-1].children:this.nodes).push({name:t,attrs:{class:nt[t]||"",style:this.tagStyle[t]||""}})}},ut.prototype.popNode=function(){const t=this.stack.pop();let e=t.attrs;const s=t.children,i=this.stack[this.stack.length-1],a=i?i.children:this.nodes;if(!this.hook(t)||at.ignoreTags[t.name])return"title"===t.name&&s.length&&"text"===s[0].type&&this.options.setTitle&&$({title:s[0].text}),void a.pop();if(t.pre&&2!==this.pre){this.pre=t.pre=void 0;for(let t=this.stack.length;t--;)this.stack[t].pre&&(this.pre=1)}const n={};if("svg"===t.name){if(this.xml>1)return void this.xml--;let s="";const i=e.style;return e.style="",e.xmlns="http://www.w3.org/2000/svg",function t(e){if("text"===e.type)return void(s+=e.text);const i=at.svgDict[e.name]||e.name;s+="<"+i;for(const a in e.attrs){const t=e.attrs[a];t&&(s+=` ${at.svgDict[a]||a}="${t}"`)}if(e.children){s+=">";for(let s=0;s<e.children.length;s++)t(e.children[s]);s+="</"+i+">"}else s+="/>"}(t),t.name="img",t.attrs={src:"data:image/svg+xml;utf8,"+s.replace(/#/g,"%23"),style:i,ignore:"T"},t.children=void 0,void(this.xml=!1)}if(e.align&&("table"===t.name?"center"===e.align?n["margin-inline-start"]=n["margin-inline-end"]="auto":n.float=e.align:n["text-align"]=e.align,e.align=void 0),e.dir&&(n.direction=e.dir,e.dir=void 0),"font"===t.name&&(e.color&&(n.color=e.color,e.color=void 0),e.face&&(n["font-family"]=e.face,e.face=void 0),e.size)){let t=parseInt(e.size);isNaN(t)||(t<1?t=1:t>7&&(t=7),n["font-size"]=["x-small","small","medium","large","x-large","xx-large","xxx-large"][t-1]),e.size=void 0}if((e.class||"").includes("align-center")&&(n["text-align"]="center"),Object.assign(n,this.parseStyle(t)),"table"!==t.name&&parseInt(n.width)>lt&&(n["max-width"]="100%",n["box-sizing"]="border-box"),at.blockTags[t.name]?t.name="div":at.trustTags[t.name]||this.xml||(t.name="span"),"a"===t.name||"ad"===t.name||"iframe"===t.name)this.expose();else if("video"===t.name)(n.height||"").includes("auto")&&(n.height=void 0);else if("ul"!==t.name&&"ol"!==t.name||!t.c){if("table"===t.name){let i=parseFloat(e.cellpadding),a=parseFloat(e.cellspacing);const l=parseFloat(e.border),o=n["border-color"],r=n["border-style"];if(t.c&&(isNaN(i)&&(i=2),isNaN(a)&&(a=2)),l&&(e.style+=`;border:${l}px ${r||"solid"} ${o||"gray"}`),t.flag&&t.c){n.display="grid",a?(n["grid-gap"]=a+"px",n.padding=a+"px"):l&&(e.style+=";border-left:0;border-top:0");const c=[],h=[],d=[],u={};!function t(e){for(let s=0;s<e.length;s++)"tr"===e[s].name?h.push(e[s]):t(e[s].children||[])}(s);for(let t=1;t<=h.length;t++){let e=1;for(let s=0;s<h[t-1].children.length;s++){const n=h[t-1].children[s];if("td"===n.name||"th"===n.name){for(;u[t+"."+e];)e++;let s=n.attrs.style||"",h=s.indexOf("width")?s.indexOf(";width"):0;if(-1!==h){let t=s.indexOf(";",h+6);-1===t&&(t=s.length),n.attrs.colspan||(c[e]=s.substring(h?h+7:6,t)),s=s.substr(0,h)+s.substr(t)}if(s+=";display:flex",h=s.indexOf("vertical-align"),-1!==h){const t=s.substr(h+15,10);t.includes("middle")?s+=";align-items:center":t.includes("bottom")&&(s+=";align-items:flex-end")}else s+=";align-items:center";if(h=s.indexOf("text-align"),-1!==h){const t=s.substr(h+11,10);t.includes("center")?s+=";justify-content: center":t.includes("right")&&(s+=";justify-content: right")}if(s=(l?`;border:${l}px ${r||"solid"} ${o||"gray"}`+(a?"":";border-right:0;border-bottom:0"):"")+(i?`;padding:${i}px`:"")+";"+s,n.attrs.colspan&&(s+=`;grid-column-start:${e};grid-column-end:${e+parseInt(n.attrs.colspan)}`,n.attrs.rowspan||(s+=`;grid-row-start:${t};grid-row-end:${t+1}`),e+=parseInt(n.attrs.colspan)-1),n.attrs.rowspan){s+=`;grid-row-start:${t};grid-row-end:${t+parseInt(n.attrs.rowspan)}`,n.attrs.colspan||(s+=`;grid-column-start:${e};grid-column-end:${e+1}`);for(let s=1;s<n.attrs.rowspan;s++)for(let i=0;i<(n.attrs.colspan||1);i++)u[t+s+"."+(e-i)]=1}s&&(n.attrs.style=s),d.push(n),e++}}if(1===t){let t="";for(let s=1;s<e;s++)t+=(c[s]?c[s]:"auto")+" ";n["grid-template-columns"]=t}}t.children=d}else t.c&&(n.display="table"),isNaN(a)||(n["border-spacing"]=a+"px"),(l||i)&&function t(e){for(let s=0;s<e.length;s++){const a=e[s];"th"===a.name||"td"===a.name?(l&&(a.attrs.style=`border:${l}px ${r||"solid"} ${o||"gray"};${a.attrs.style||""}`),i&&(a.attrs.style=`padding:${i}px;${a.attrs.style||""}`)):a.children&&t(a.children)}}(s);if(this.options.scrollTable&&!(e.style||"").includes("inline")){const s=Object.assign({},t);t.name="div",t.attrs={style:"overflow:auto"},t.children=[s],e=s.attrs}}else if("td"!==t.name&&"th"!==t.name||!e.colspan&&!e.rowspan)if("ruby"===t.name){t.name="span";for(let t=0;t<s.length-1;t++)"text"===s[t].type&&"rt"===s[t+1].name&&(s[t]={name:"div",attrs:{style:"display:inline-block;text-align:center"},children:[{name:"div",attrs:{style:"font-size:50%;"+(s[t+1].attrs.style||"")},children:s[t+1].children},s[t]]},s.splice(t+1,1))}else t.c&&function(t){t.c=2;for(let e=t.children.length;e--;){const s=t.children[e];s.c&&"table"!==s.name||(t.c=1)}}(t);else for(let o=this.stack.length;o--;)if("table"===this.stack[o].name){this.stack[o].flag=1;break}}else{const t={a:"lower-alpha",A:"upper-alpha",i:"lower-roman",I:"upper-roman"};t[e.type]&&(e.style+=";list-style-type:"+t[e.type],e.type=void 0);for(let e=s.length;e--;)"li"===s[e].name&&(s[e].c=1)}if((n.display||"").includes("flex")&&!t.c)for(let o=s.length;o--;){const t=s[o];t.f&&(t.attrs.style=(t.attrs.style||"")+t.f,t.f=void 0)}const l=i&&((i.attrs.style||"").includes("flex")||(i.attrs.style||"").includes("grid"))&&!t.c;l&&(t.f=";max-width:100%"),s.length>=50&&t.c&&!(n.display||"").includes("flex")&&dt(s);for(const o in n)if(n[o]){const s=`;${o}:${n[o].replace(" !important","")}`;l&&(o.includes("flex")&&"flex-direction"!==o||"align-self"===o||o.includes("grid")||"-"===n[o][0]||o.includes("width")&&s.includes("%"))?(t.f+=s,"width"===o&&(e.style+=";width:100%")):e.style+=s}e.style=e.style.substr(1)||void 0},ut.prototype.onText=function(t){if(!this.pre){let e,s="";for(let i=0,a=t.length;i<a;i++)ot[t[i]]?(" "!==s[s.length-1]&&(s+=" "),"\n"!==t[i]||e||(e=!0)):s+=t[i];if(" "===s){if(e)return;{const t=this.stack[this.stack.length-1];if(t&&"t"===t.name[0])return}}t=s}const e=Object.create(null);if(e.type="text",e.text=ht(t),this.hook(e)){(this.stack.length?this.stack[this.stack.length-1].children:this.nodes).push(e)}},pt.prototype.parse=function(t){this.content=t||"",this.i=0,this.start=0,this.state=this.text;for(let e=this.content.length;-1!==this.i&&this.i<e;)this.state()},pt.prototype.checkClose=function(t){const e="/"===this.content[this.i];return!!(">"===this.content[this.i]||e&&">"===this.content[this.i+1])&&(t&&this.handler[t](this.content.substring(this.start,this.i)),this.i+=e?2:1,this.start=this.i,this.handler.onOpenTag(e),"script"===this.handler.tagName?(this.i=this.content.indexOf("</",this.i),-1!==this.i&&(this.i+=2,this.start=this.i),this.state=this.endTag):this.state=this.text,!0)},pt.prototype.text=function(){if(this.i=this.content.indexOf("<",this.i),-1===this.i)return void(this.start<this.content.length&&this.handler.onText(this.content.substring(this.start,this.content.length)));const t=this.content[this.i+1];if(t>="a"&&t<="z"||t>="A"&&t<="Z")this.start!==this.i&&this.handler.onText(this.content.substring(this.start,this.i)),this.start=++this.i,this.state=this.tagName;else if("/"===t||"!"===t||"?"===t){this.start!==this.i&&this.handler.onText(this.content.substring(this.start,this.i));const e=this.content[this.i+2];if("/"===t&&(e>="a"&&e<="z"||e>="A"&&e<="Z"))return this.i+=2,this.start=this.i,void(this.state=this.endTag);let s="--\x3e";"!"===t&&"-"===this.content[this.i+2]&&"-"===this.content[this.i+3]||(s=">"),this.i=this.content.indexOf(s,this.i),-1!==this.i&&(this.i+=s.length,this.start=this.i)}else this.i++},pt.prototype.tagName=function(){if(ot[this.content[this.i]]){for(this.handler.onTagName(this.content.substring(this.start,this.i));ot[this.content[++this.i]];);this.i<this.content.length&&!this.checkClose()&&(this.start=this.i,this.state=this.attrName)}else this.checkClose("onTagName")||this.i++},pt.prototype.attrName=function(){let t=this.content[this.i];if(ot[t]||"="===t){this.handler.onAttrName(this.content.substring(this.start,this.i));let e="="===t;const s=this.content.length;for(;++this.i<s;)if(t=this.content[this.i],!ot[t]){if(this.checkClose())return;if(e)return this.start=this.i,void(this.state=this.attrVal);if("="!==this.content[this.i])return this.start=this.i,void(this.state=this.attrName);e=!0}}else this.checkClose("onAttrName")||this.i++},pt.prototype.attrVal=function(){const t=this.content[this.i],e=this.content.length;if('"'===t||"'"===t){if(this.start=++this.i,this.i=this.content.indexOf(t,this.i),-1===this.i)return;this.handler.onAttrVal(this.content.substring(this.start,this.i))}else for(;this.i<e;this.i++){if(ot[this.content[this.i]]){this.handler.onAttrVal(this.content.substring(this.start,this.i));break}if(this.checkClose("onAttrVal"))return}for(;ot[this.content[++this.i]];);this.i<e&&!this.checkClose()&&(this.start=this.i,this.state=this.attrName)},pt.prototype.endTag=function(){const t=this.content[this.i];if(ot[t]||">"===t||"/"===t){if(this.handler.onCloseTag(this.content.substring(this.start,this.i)),">"!==t&&(this.i=this.content.indexOf(">",this.i),-1===this.i))return;this.start=++this.i,this.state=this.text}else this.i++};const mt=[];const gt=U({name:"u-parse",data:()=>({nodes:[]}),props:{containerStyle:{type:String,default:""},content:{type:String,default:""},copyLink:{type:[Boolean,String],default:!0},domain:String,errorImg:{type:String,default:""},lazyLoad:{type:[Boolean,String],default:!1},loadingImg:{type:String,default:""},pauseVideo:{type:[Boolean,String],default:!0},previewImg:{type:[Boolean,String],default:!0},scrollTable:[Boolean,String],selectable:[Boolean,String],setTitle:{type:[Boolean,String],default:!0},showImgMenu:{type:[Boolean,String],default:!0},tagStyle:Object,useAnchor:[Boolean,Number]},emits:["load","ready","imgtap","linktap","play","error"],components:{node:it},watch:{content(t){this.setContent(t)}},created(){this.plugins=[];for(let t=mt.length;t--;)this.plugins.push(new mt[t](this))},mounted(){this.content&&!this.nodes.length&&this.setContent(this.content)},beforeDestroy(){this._hook("onDetached")},methods:{in(t,e,s){t&&e&&s&&(this._in={page:t,selector:e,scrollTop:s})},navigateTo(t,e){return new Promise(((s,i)=>{if(!this.useAnchor)return void i(Error("Anchor is disabled"));e=e||parseInt(this.useAnchor)||0;const a=N().in(this._in?this._in.page:this).select((this._in?this._in.selector:"._root")+(t?` #${t}`:"")).boundingClientRect();this._in?a.select(this._in.selector).scrollOffset().select(this._in.selector).boundingClientRect():a.selectViewport().scrollOffset(),a.exec((t=>{if(!t[0])return void i(Error("Label not found"));const a=t[1].scrollTop+t[0].top-(t[2]?t[2].top:0)+e;this._in?this._in.page[this._in.scrollTop]=a:L({scrollTop:a,duration:300}),s()}))}))},getText(t){let e="";return function t(s){for(let i=0;i<s.length;i++){const a=s[i];if("text"===a.type)e+=a.text.replace(/&amp;/g,"&");else if("br"===a.name)e+="\n";else{const s="p"===a.name||"div"===a.name||"tr"===a.name||"li"===a.name||"h"===a.name[0]&&a.name[1]>"0"&&a.name[1]<"7";s&&e&&"\n"!==e[e.length-1]&&(e+="\n"),a.children&&t(a.children),s&&"\n"!==e[e.length-1]?e+="\n":"td"!==a.name&&"th"!==a.name||(e+="\t")}}}(t||this.nodes),e},getRect(){return new Promise(((t,e)=>{N().in(this).select("#_root").boundingClientRect().exec((s=>s[0]?t(s[0]):e(Error("Root label not found"))))}))},pauseMedia(){for(let t=(this._videos||[]).length;t--;)this._videos[t].pause()},setPlaybackRate(t){this.playbackRate=t;for(let e=(this._videos||[]).length;e--;)this._videos[e].playbackRate(t)},setContent(t,e){e&&this.imgList||(this.imgList=[]);const s=new ut(this).parse(t);if(this.$set(this,"nodes",e?(this.nodes||[]).concat(s):s),this._videos=[],this.$nextTick((()=>{this._hook("onLoad"),this.$emit("load")})),this.lazyLoad||this.imgList._unloadimgs<this.imgList.length/2){let t=0;const e=s=>{s&&s.height||(s={}),s.height===t?this.$emit("ready",s):(t=s.height,setTimeout((()=>{this.getRect().then(e).catch(e)}),350))};this.getRect().then(e).catch(e)}else this.imgList._unloadimgs||this.getRect().then((t=>{this.$emit("ready",t)})).catch((()=>{this.$emit("ready",{})}))},_hook(t){for(let e=mt.length;e--;)this.plugins[e][t]&&this.plugins[e][t]()}}},[["render",function(t,e,s,i,a,c){const h=n("node"),d=k;return l(),o(d,{id:"_root",class:m((s.selectable?"_select ":"")+"_root"),style:u(s.containerStyle)},{default:r((()=>[a.nodes[0]?(l(),o(h,{key:1,childs:a.nodes,opts:[s.lazyLoad,s.loadingImg,s.errorImg,s.showImgMenu,s.selectable],name:"span"},null,8,["childs","opts"])):O(t.$slots,"default",{key:0},void 0,!0)])),_:3},8,["class","style"])}],["__scopeId","data-v-5b9de8e9"]]),ft=U({__name:"detail",setup(t){const e=j.importObject("utilsObj",{customUI:!0}),s=j.database(),a=S(!1);S(!0);const n=S(""),u=S(!0),g=S(null);S(!0);let x=S(null);const w=S([]),T=S({article_id:"",comment_type:0}),N=S(!1),L=S("more"),O=S(!1);V((t=>{t.id?(n.value=t.id,T.value.article_id=t.id,nt(),it(),st(),et()):at()}));const U=t=>{tt.value=tt.value.filter((e=>e._id!==t._id))},Y=t=>{tt.value.unshift({...T.value,...t,user_id:[X.userInfo]})},tt=S([]),et=async()=>{const t=s.collection("quanzi_comment").where(`article_id == '${n.value}' && comment_type == 0`).orderBy("comment_date desc").getTemp(),e=s.collection("uni-id-users").field("_id,avatar_file,username,nickname").getTemp(),i=await s.collection(t,e).where("comment_status != 0").skip(tt.value.length).limit(5).get();console.log(i);let l=i.result.data.map((t=>t._id));0===i.result.data.length&&(O.value=!0),5===i.result.data.length&&(a.value=!0);const o=await s.collection("quanzi_comment").where({reply_comment_id:s.command.in(l),comment_status:1}).groupBy("reply_comment_id").groupField("count(*) as totalReply").get();i.result.data.forEach((t=>{let e=o.result.data.findIndex((e=>e.reply_comment_id===t._id));e>-1&&(t.totalReply=o.result.data[e].totalReply)})),tt.value.length||(N.value=!0);let r=[...tt.value,...i.result.data];tt.value=r};D((async()=>{L.value="loading",O.value?L.value="noMore":(await et(),O.value?L.value="noMore":console.log(O.value))})),I("totalReply",(t=>{tt.value.forEach((e=>{e.article_id===t.article_id&&(e.totalReply+=t.count)}))}));const st=async()=>{const t=s.collection("quanzi_like").where(`article_id == "${n.value}"`).getTemp(),e=s.collection("uni-id-users").field("_id,avatar_file").getTemp(),i=await s.collection(t,e).orderBy("publish_date desc").limit(5).get();i.result.data=i.result.data.reverse(),w.value=i.result.data,console.log(w.value)},it=()=>{e.operation("quanzi_aticle","view_count",n.value,1).then((t=>{}))},at=()=>{C({title:"参数错误",icon:"none"}),setTimeout((()=>{R({url:"/pages/index/index"})}),1e3)},nt=()=>{const t=z("uni-id-pages-userInfo");let e=s.collection("quanzi_aticle").where(`_id == '${n.value}'`).getTemp(),i=s.collection("uni-id-users").field("_id,username,nickname,avatar_file").getTemp(),a=s.collection("quanzi_like").where(`article_id == '${n.value}' && user_id == '${t._id}'`).getTemp();s.collection(e,i,a).get({getOne:!0}).then((t=>{if(console.log(t),!t.result.data)return void at();g.value=t.result.data,console.log(g.value),u.value=!1;let e=!!t.result.data._id.quanzi_like.length;t.result.data.isLike=e,$({title:g.value.title})})).catch((t=>{at()}))},lt=S({p:"line-height: 1.7em; font-size: 16px;  padding-bottom: 10rpx",img:"margin: 10rpx 0 "}),ot=async()=>{if(!X.hasLogin)return void q({title:"未登录，请先登录",success:t=>{t.confirm&&i({url:"/"+B.uniIdRouter.loginPage})}});let t=Date.now();t-x.value<2e3?C({title:"操作频繁",icon:"none"}):(g.value.isLike?g.value.like_count--:g.value.like_count++,g.value.isLike=!g.value.isLike,x.value=t,H(n.value))};return(t,e)=>{const s=M(E("u-skeleton"),F),i=k,n=b,x=M(E("uni-dateformat"),P),$=M(E("u-parse"),gt),O=_,j=M(E("u-empty"),G),S=M(E("comment-item"),Z),I=M(E("uni-load-more"),W),C=M(E("comment-frame"),K);return l(),o(i,{class:"detail"},{default:r((()=>[v(i,{class:"container"},{default:r((()=>[u.value?(l(),o(i,{key:0},{default:r((()=>[v(s,{loading:!0,animate:!0,rows:"5"})])),_:1})):(l(),o(i,{key:1},{default:r((()=>[v(i,{class:"title"},{default:r((()=>[f(y(g.value.title),1)])),_:1}),v(i,{class:"userinfo"},{default:r((()=>[v(i,{class:"avatar"},{default:r((()=>[v(n,{src:A(J)(g.value),mode:"aspectFill"},null,8,["src"])])),_:1}),v(i,{class:"text"},{default:r((()=>[v(i,{class:"name"},{default:r((()=>[f(y(A(Q)(g.value)),1)])),_:1}),v(i,{class:"small"},{default:r((()=>[v(x,{date:g.value.publish_date,format:"yyyy年MM月dd hh:mm:ss"},null,8,["date"]),f("· 发布于"+y(g.value.province),1)])),_:1})])),_:1})])),_:1}),v(i,{class:"content"},{default:r((()=>[v($,{content:g.value.content,tagStyle:lt.value},null,8,["content","tagStyle"])])),_:1}),v(i,{class:"like"},{default:r((()=>[v(i,{class:m(["btn",g.value.isLike?"active":""]),onClick:ot},{default:r((()=>[v(O,{class:"iconfont icon-good-fill"}),g.value.like_count?(l(),o(O,{key:0},{default:r((()=>[f(y(g.value.like_count),1)])),_:1})):p("",!0)])),_:1},8,["class"]),v(i,{class:"users"},{default:r((()=>[(l(!0),c(h,null,d(w.value,(t=>(l(),c(h,null,[t.user_id[0]?(l(),o(n,{key:0,src:A(J)(t),mode:"aspectFill"},null,8,["src"])):p("",!0)],64)))),256))])),_:1}),v(i,{class:"text"},{default:r((()=>[v(O,{class:"num"},{default:r((()=>[f(y(g.value.view_count),1)])),_:1}),f("人看过")])),_:1})])),_:1})])),_:1}))])),_:1}),v(i,{class:"comment"},{default:r((()=>[!tt.value.length&&N.value?(l(),o(i,{key:0},{default:r((()=>[v(j,{mode:"comment",icon:"https://cdn.uviewui.com/uview/empty/comment.png"})])),_:1})):(l(),o(i,{key:1,class:"content"},{default:r((()=>[(l(!0),c(h,null,d(tt.value,(t=>(l(),o(i,{class:"item"},{default:r((()=>[v(S,{item:t,totalReply:null==t?void 0:t.totalReply,onRemoveEnv:U},null,8,["item","totalReply"])])),_:2},1024)))),256))])),_:1})),v(i,null,{default:r((()=>[a.value?(l(),o(I,{key:0,status:L.value},null,8,["status"])):p("",!0)])),_:1})])),_:1}),v(C,{commentObjadd:T.value,onCommentEnv:Y},null,8,["commentObjadd"])])),_:1})}}},[["__scopeId","data-v-686346fa"]]);export{ft as default};
